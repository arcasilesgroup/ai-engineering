# Generated by ai-engineering â€” Git hooks via Lefthook

pre-commit:
  parallel: true
  commands:
    gitleaks:
      run: gitleaks protect --staged --no-banner
    eslint:
      glob: "*.{ts,tsx,js,jsx}"
      run: npx eslint {staged_files}
    prettier:
      glob: "*.{ts,tsx,js,jsx,json,md,yml,yaml,css,scss}"
      run: npx prettier --check {staged_files}

commit-msg:
  commands:
    conventional:
      run: |
        MSG=$(cat {1})
        if echo "$MSG" | grep -qE "^Merge |^Revert "; then exit 0; fi
        if ! echo "$MSG" | head -1 | grep -qE '^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([a-zA-Z0-9_-]+\))?: .{1,}'; then
          echo "Commit message must follow Conventional Commits: <type>(<scope>): <description>"
          exit 1
        fi

pre-push:
  parallel: true
  commands:
    branch-protection:
      run: |
        BRANCH=$(git branch --show-current)
        if [ "$BRANCH" = "main" ]; then echo "Direct push to main blocked. Use a PR."; exit 1; fi
        if [ "$BRANCH" = "develop" ]; then echo "Direct push to develop blocked. Use a PR."; exit 1; fi
    lint:
      run: npx eslint .
    typecheck:
      run: npx tsc --noEmit
    test:
      run: npm test
    build:
      run: npm run build
    npm-audit:
      run: npm audit --audit-level=high
    gitleaks-branch:
      run: gitleaks detect --source . --log-opts "$(git merge-base HEAD origin/main)..HEAD" --no-banner
    semgrep:
      run: semgrep --config=auto --error .
