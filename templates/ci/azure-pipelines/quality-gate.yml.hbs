# Generated by ai-engineering v{{version}}
trigger: none

pr:
  branches:
    include:
{{#each protectedBranches}}
      - {{this}}
{{/each}}

pool:
  vmImage: ubuntu-latest

steps:
  - checkout: self
{{#ifIncludes stacks "typescript-react"}}
  - task: NodeTool@0
    inputs:
      versionSpec: "20.x"
  - script: npm ci
    displayName: Install
  - script: |
      npm run lint
      npm run typecheck
      npm test -- --coverage
    displayName: Quality Gate
{{/ifIncludes}}
{{#ifIncludes stacks "dotnet"}}
  - task: UseDotNet@2
    inputs:
      packageType: sdk
      version: "8.0.x"
  - script: |
      dotnet restore
      dotnet build --no-restore
      dotnet test --no-build
    displayName: Quality Gate
{{/ifIncludes}}
{{#ifIncludes stacks "python"}}
  - task: UsePythonVersion@0
    inputs:
      versionSpec: "3.12"
  - script: |
      pip install -r requirements.txt
      ruff check .
      pytest --cov --cov-fail-under=80
    displayName: Quality Gate
{{/ifIncludes}}
